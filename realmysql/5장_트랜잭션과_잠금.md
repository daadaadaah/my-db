# 5장 트랜잭션과 잠금

## 요약
- MySQL의 동시성에 영향을 미치는 Lock, 트랜잭션, 트랜잭션 격리수준에 대해 살펴보자.
- `트랜잭션`은 작업의 완전성을 보장해주는 것이다. 즉, 논리적인 작어 셋을 모두 성공적으로 처리하거나, 1개라도 실패해서 처리하지 못할 경우 원 상태로 복구해서, 작업의 일부만 적용되는 현상(Partial update)이 발생하지 않게 만들어주는 기능이다.
- 만약, 트랜잭션을 사용하지 않아서 부분 업데이트 현상이 발생하게 된다면, 테이블 데이터의 정합성을 맞추는데 상당한 리소스가 들어간다.
- 왜냐하면, 실패한 쿼리로 인해 남은 레코드를 다시 삭제하는 재처리작업이 필요할 수도 있기 때문이다.
- 만약, 실행하는 쿼리가 1개뿐이라면, 재처리 작업은 간단할 것이지만, 2개 이상이 쿼리가 실행된 경우거나 복잡한 쿼리라면 재처리 작업하는데 리소스가 많이 들어갈 것이다.
  

- `트랜잭션`과 `Lock`이 서로 비슷한 개념 같지만, `Lock`은 동시성을 제어하기 위한 기능이고 `트랜잭션`은 데이터의 정합성을 보장하기 위한 기능이다.
- `Lock`은 여러 connection에서 동시에 동일한 자원(레코드 또는 테이블)을 변경하려고 할 경우, 순서대로 1개의 시점에는 1개의 connection만 변경할 수 있게 해주는 역할이다.
- 만약, Lock을 하지 않는다면, 1개의 데이터에 여러 connection에서 동시에 변경하게 되어, 해당 데이터의 값은 예측할 수 없는 상태가 되는 문제가 발생한다.
- `트랜잭션의 격리 수준`은 1개의 트랜잭션 내에서 또는 여러 트랜잭션 간의 작업 내용을 어떻게 공유하고 차단할 것인지를 결정하는 레벨읠 의미한다.


## 5.1 트랜잭션
### MySQL에서의 트랜잭션
- `트랜잭션`은 1개의 쿼리든 2개 이상의 쿼리든 관계없이 1개의 논리적인 작업 셋 자체가 100% 적용(commit시)되거나 아무것도 적용되지 않아야(rollback) 함을 보장해주는 것이다.

### 주의사항
- DBMS의 커넥션과 동일하게, 프로그램 코드에서 트랜잭션의 범위를 최소화하는 것이 좋다.
- 왜냐하면, DB 커넥션은 개수가 제한적이어서, 각 단위 프로그램이 커넥션을 소유하는 시간이 길어질수록 사용 가능한 여유 커넥션의 개수는 줄어들 것이고, 어느 순간에는 각 단위 프로그램에서 커넥션을 가져가기 위해 기다려야 하는 상황이 발생할 수 있기 때문이다.
- 이로인해 DB 처리량이 줄어들기 때문에?
- 즉, 프로그램의 코드가 DB 커넥션을 가지고 있는 범위와 트랜잭션이 활성화돼 있는 프로그램의 범위를 최소화해야 한다는 것이다.
- 또한, 프로그램의 코드에서 라인 수는 1~2줄이라고 하더라도, 네트워크 작업이 있는 경우에는 반드시 트랜잭션에서 배제해야 한다.
- 왜냐하면, DBMS 서버가 높은 부하 상태로 빠지거나 위험한 상태에 빠지는 경우가 빈번히 발생하기 때문이다.

## 5.2 MySQL 엔진의 잠금

### 글로벌 락



## 5.3 InnoDB 스토리지 엔진 잠금


## 5.4 MySQL의 격리 수준






